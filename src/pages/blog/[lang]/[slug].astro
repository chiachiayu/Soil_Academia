---
import Layout from '@/layouts/Layout.astro'
import { getCollection, render } from 'astro:content'

export async function getStaticPaths() {
	const blogEntries = await getCollection('blog')

	return blogEntries.map(post => ({
		params: { lang: post.id.split('/')[0], slug: post.id.split('/')[1] },
		props: { post },
	}))
}

const { post } = Astro.props
const { title, description, publishedAt, tags } = post.data
const { Content } = await render(post)

const publishedDate = new Date(publishedAt)
---

<Layout title={title}>
	<div class='mx-auto w-full max-w-3xl px-6 lg:max-w-4xl lg:px-0'>
		<article class='prose max-w-none w-full text-left prose-headings:text-base-content prose-p:text-base-content/80'>
			<div class='mb-8 border-b pb-8'>
				<h1 class='text-4xl font-bold mb-4 text-base-content break-words'>{title}</h1>
				{description && (
					<p class='text-lg text-base-content/70 leading-relaxed mb-4'>{description}</p>
				)}
				<div class='flex flex-wrap items-center gap-4 text-base-content/70'>
					<time datetime={publishedDate.toISOString()} class='flex items-center'>
						<svg
							xmlns='http://www.w3.org/2000/svg'
							class='h-4 w-4 mr-2'
							fill='none'
							viewBox='0 0 24 24'
							stroke='currentColor'
						>
							<path
								stroke-linecap='round'
								stroke-linejoin='round'
								stroke-width='2'
								d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'
							></path>
						</svg>
						{
							publishedDate.toLocaleDateString('en-US', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
							})
						}
					</time>

					{
						tags && (
							<div class='flex flex-wrap gap-2'>
								{tags.map(tag => (
									<span class='badge badge-accent badge-outline'>{tag}</span>
								))}
							</div>
						)
					}
				</div>
			</div>

			<div
				class='prose max-w-3xl mt-8 prose-h2:text-2xl prose-h2:font-bold prose-h2:mb-4
         prose-h3:text-xl prose-h3:font-semibold prose-h3:mb-3
         prose-p:mb-4 prose-p:leading-relaxed prose-p:text-justify
         prose-strong:text-base-content prose-strong:font-bold
         prose-em:italic
         prose-a:text-accent prose-a:no-underline hover:prose-a:underline
         prose-code:text-accent prose-code:bg-base-200 prose-code:px-1 prose-code:py-0.5 prose-code:rounded
         prose-blockquote:border-l-4 prose-blockquote:border-accent prose-blockquote:pl-4 prose-blockquote:italic
         prose-ul:list-disc prose-ul:pl-6
         prose-ol:list-decimal prose-ol:pl-6
         prose-li:mb-2
         prose-img:rounded-xl prose-img:my-8 prose-img:mx-auto
         prose-figcaption:text-center blog-content'
			>
				<Content />
			</div>
		</article>
	</div>
</Layout>

<style is:global>
	.blog-content :where(figure),
	.blog-content :where(img) {
		height: auto;
		display: block;
		margin-left: auto;
		margin-right: auto;
		object-fit: contain;
	}

	.blog-content :where(img) {
		max-width: 100%;
	}

	.blog-content :where(figure) {
		overflow: hidden;
	}

	@media (max-width: 640px) {
		.blog-content {
			padding-inline: 0.25rem;
		}

		.blog-content :where(img) {
			border-radius: 0.9rem;
		}
	}
</style>
