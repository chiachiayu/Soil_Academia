---
import Layout from '@/layouts/Layout.astro'
import { template } from '@/settings'
import { getCollection } from 'astro:content'

const blogEntries = await getCollection('blog')

const categoryTaglines: Record<'zh' | 'en', Record<string, string>> = {
	zh: {
		田野: '田野觀察與第一手紀錄',
		思考: '長線思辨與概念梳理',
		方法: '研究設計與工具操作',
		記錄: '日常筆記與幕後花絮',
		札記: '在科學知識與長期結果之間，留下不該被快速總結的痕跡',
		讀書心得: '閱讀後的重點摘錄與反思',
	},
	en: {
		'Research Notes': 'Work-in-progress findings and data sanity checks',
		'Methods & Models': 'Study design, code snippets, and reproducible recipes',
		'Field Observations': 'On-site notes and contextual details',
		'Data & Figures': 'Charts, datasets, and exploratory visuals',
		Perspectives: 'Opinion pieces and broader takes',
		'Book remarks': 'Highlights and reflections from readings',
	},
}

const buildCategoryList = (lang: 'zh' | 'en') => {
	const counts = new Map<string, number>()
	blogEntries
		.filter(post => post.data.lang === lang && !post.data.draft)
		.forEach(post => {
			const name = post.data.category
			counts.set(name, (counts.get(name) ?? 0) + 1)
		})

	return Array.from(counts.entries())
		.map(([name, count]) => ({
			name,
			slug: name,
			count,
			href: `${template.base}/blog/category/${encodeURIComponent(name)}/1`,
		}))
		.filter(cat => cat.count > 0)
		.sort((a, b) => b.count - a.count || a.name.localeCompare(b.name))
}

const zhCategories = buildCategoryList('zh')
const enCategories = buildCategoryList('en')
---

<Layout title='Blog Categories'>
	<section class='mx-auto w-full max-w-5xl px-6 lg:px-0 space-y-10'>
		<header class='space-y-3'>
			<p class='text-sm font-semibold uppercase tracking-[0.08em] text-accent'>Blog</p>
			<h1 class='text-3xl font-bold text-base-content'>分類 Category</h1>
			<p class='text-base text-base-content/70'>
				請挑選喜歡的分類，文章分為中文與英文。
			</p>
		</header>

		<div class='grid gap-8'>
			<section class='space-y-4'>
				<div class='flex items-center gap-2'>
					<span class='text-lg font-semibold'>中文分類</span>
					<span class='badge badge-outline'>{zhCategories.length}</span>
				</div>
				<div class='grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4'>
					{
						zhCategories.length > 0 ? (
							zhCategories.map(cat => (
								<a
									href={cat.href}
									class='card bg-base-200 border border-base-300 hover:border-accent transition-colors'
								>
									<div class='card-body'>
							<div class='flex items-center justify-between'>
								<h2 class='card-title text-base-content'>{cat.name}</h2>
								<span class='badge badge-accent badge-outline'>{cat.count}</span>
							</div>
							<p class='text-sm text-base-content/70'>
								{categoryTaglines.zh[cat.name] ?? '中文文章'}
							</p>
						</div>
					</a>
				))
			) : (
				<p class='text-base-content/60'>目前尚無中文分類。</p>
						)
					}
				</div>
			</section>

			<section class='space-y-4'>
				<div class='flex items-center gap-2'>
					<span class='text-lg font-semibold'>English categories</span>
					<span class='badge badge-outline'>{enCategories.length}</span>
				</div>
				<div class='grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4'>
					{
						enCategories.length > 0 ? (
							enCategories.map(cat => (
								<a
									href={cat.href}
									class='card bg-base-200 border border-base-300 hover:border-accent transition-colors'
								>
									<div class='card-body'>
							<div class='flex items-center justify-between'>
								<h2 class='card-title text-base-content'>{cat.name}</h2>
								<span class='badge badge-accent badge-outline'>{cat.count}</span>
							</div>
							<p class='text-sm text-base-content/70'>
								{categoryTaglines.en[cat.name] ?? 'English posts'}
							</p>
						</div>
					</a>
				))
			) : (
				<p class='text-base-content/60'>No English categories yet.</p>
						)
					}
				</div>
			</section>
		</div>
	</section>
</Layout>
